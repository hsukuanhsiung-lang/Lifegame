
<!-- saved from url=(0051)file:///C:/Users/Administrator/Downloads/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body>if(S.onboardStep==='askName'){
      S.userName=txt;
      S.memory.user.push(`ç”¨æˆ·åç§°ï¼š${txt}`);
      sv();
      setTimeout(()=&gt;{addM('a',`å¥½çš„ï¼Œ${txt}ï¼Œä»¥åè¯·å¤šå…³ç…§ ğŸ˜Š\n\né‚£ä¹ˆç°åœ¨ï¼Œä½ å¸Œæœ›æ€ä¹ˆç§°å‘¼æˆ‘å‘¢ï¼Ÿ`);S.onboardStep='askAIName';sv();},400);
      return;
    }
    if(S.onboardStep==='askAIName'){
      S.aiName=txt;
      S.memory.pref.push(`AIæ˜µç§°ï¼š${txt}`);
      document.getElementById('aiName').textContent=txt;
      S.onboarded=true;
      S.onboardStep=null;
      sv();
      setTimeout(()=&gt;{
        addM('a',`å¾ˆå¥½ï¼ä»ç°åœ¨å¼€å§‹ï¼Œä½ å¯ä»¥å«æˆ‘${txt} ğŸ®\n\nè®©æˆ‘ä»¬å¼€å§‹ä½ çš„äººç”Ÿæ¸¸æˆå§ï¼\n\nä½ å¯ä»¥è¿™æ ·è®°å½•æ—¶é—´ï¼š\n"14:00-16:00 è¯»ä¹¦"\n"æ™šä¸Š8ç‚¹åˆ°10ç‚¹å¥èº«"\n\næˆ–è€…ç›´æ¥é—®æˆ‘ï¼š\n"ä»Šæ—¥æ€»ç»“" â†’ æŸ¥çœ‹ä»Šå¤©çš„è¿›åº¦\n"å±æ€§" â†’ æŸ¥çœ‹ä½ çš„å±æ€§å€¼\n"ä»»åŠ¡" â†’ æŸ¥çœ‹å¾…åŠäº‹é¡¹\n\néšæ—¶å‘Šè¯‰æˆ‘ä½ åœ¨åšä»€ä¹ˆï¼Œæˆ‘ä¼šå¸®ä½ è®°å½•å¹¶è®¡ç®—å±æ€§ ğŸ’ª`);
      },400);
      return;
    }
  }

  showDots();
  setTimeout(()=&gt;{hideDots();const reply=localAI(txt);addM('a',reply);},400);
}
function aKey(e){if(e.key==='Enter'&amp;&amp;!e.shiftKey){e.preventDefault();aSend();}}
function aResize(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,120)+'px';}

// â•â•â• æ—¶é—´è½¨è¿¹ï¼ˆç´§å‡‘ç‰ˆï¼Œä¸æ»šåŠ¨ï¼‰â•â•â•
let tlCol='or',tlSub=null,isDrag=false;
function rTimeline(){
  if(!S.tlDate)S.tlDate=tod();
  document.getElementById('tlLbl').textContent=fmtD(S.tlDate)+(S.tlDate===tod()?' Â· ä»Šå¤©':'');
  rTLPal();rTLSub();rTLGrid();
}
function rTLPal(){
  const row=document.getElementById('tlPal');row.innerHTML='';
  COLS.forEach(c=&gt;{
    const el=document.createElement('div');
    el.className='tcpal'+(c.k===tlCol?' on':'');
    el.style.background=c.h;
    el.textContent=c.l.slice(0,2);
    el.onclick=()=&gt;{tlCol=c.k;tlSub=null;rTLPal();rTLSub();};
    row.appendChild(el);
  });
  const cl=document.createElement('div');
  cl.className='tcpal'+(tlCol==='clr'?' on':'');
  cl.style.background='var(--bg3)';cl.style.border='2px dashed var(--border2)';
  cl.textContent='æ¸…é™¤';
  cl.onclick=()=&gt;{tlCol='clr';tlSub=null;rTLPal();rTLSub();};
  row.appendChild(cl);
}
function rTLSub(){
  const row=document.getElementById('tlSub');
  if(tlCol==='clr'||!tlCol){row.innerHTML='<span style="font-size:12px;color:var(--text2)">å…ˆé€‰ä¸Šæ–¹é¢œè‰²</span>';return;}
  const col=COLS.find(c=&gt;c.k===tlCol);if(!col){row.innerHTML='';return;}
  row.innerHTML='';
  col.s.forEach((s,i)=&gt;{
    const isOn=tlSub===s.k;
    const sh=SHADE[Math.min(i,SHADE.length-1)];
    const bg=`rgba(${parseInt(col.h.slice(1,3),16)},${parseInt(col.h.slice(3,5),16)},${parseInt(col.h.slice(5,7),16)},${sh})`;
    const chip=document.createElement('div');
    chip.className='tcsub'+(isOn?' on':'');
    chip.style.cssText=isOn?`background:${col.h};color:#0a0a0f`:`background:${bg};color:#fff`;
    chip.innerHTML=`${s.l}<span class="tcsub-del" onclick="event.stopPropagation();delSub(&#39;${col.k}&#39;,&#39;${s.k}&#39;)">Ã—</span>`;
    chip.onclick=()=&gt;{tlSub=s.k;rTLSub();};
    row.appendChild(chip);
  });
  const addBtn=document.createElement('div');
  addBtn.className='tcsub tcsub-add';addBtn.textContent='+ æ·»åŠ å°é¡¹';
  addBtn.onclick=()=&gt;{const name=prompt(`ä¸ºã€Œ${col.l}ã€æ·»åŠ æ–°å°é¡¹ï¼š`);if(!name||!name.trim())return;const newKey='s'+Date.now();col.s.push({k:newKey,l:name.trim()});tlSub=newKey;rTLSub();};
  row.appendChild(addBtn);
}
function delSub(colorKey,subKey){
  const col=COLS.find(c=&gt;c.k===colorKey);if(!col)return;
  if(col.s.length&lt;=1){alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªå°é¡¹');return;}
  col.s=col.s.filter(s=&gt;s.k!==subKey);
  if(tlSub===subKey)tlSub=col.s[0]?.k||null;
  rTLSub();
}
function rTLGrid(){
  const g=getG(S.tlDate);
  const grid=document.getElementById('tlGrid');grid.innerHTML='';
  // åªæ˜¾ç¤º6:00-23:45ï¼ˆ18å°æ—¶ï¼‰é¿å…æ»šåŠ¨
  for(let h=6;h&lt;24;h++){
    const hour=document.createElement('div');hour.className='tc-hour';
    const lbl=document.createElement('div');lbl.className='tc-hour-lbl';
    lbl.textContent=String(h).padStart(2,'0')+':00';
    hour.appendChild(lbl);
    const cells=document.createElement('div');cells.className='tc-cells';
    for(let q=0;q&lt;4;q++){
      const idx=h*4+q,cell=g[idx];
      const div=document.createElement('div');
      div.className='tc-cell';div.dataset.idx=idx;
      if(cell){
        div.classList.add('c-'+cell.c);
        const col=COLS.find(c=&gt;c.k===cell.c);
        const si=col?col.s.findIndex(s=&gt;s.k===cell.s):0;
        div.style.opacity=SHADE[Math.min(si&lt;0?0:si,SHADE.length-1)];
        if(col&amp;&amp;si&gt;=0&amp;&amp;col.s[si])div.textContent=col.s[si].l.slice(0,2);
      }
      div.addEventListener('touchstart',e=&gt;{e.preventDefault();isDrag=true;paintTL(div,idx);},{passive:false});
      div.addEventListener('touchmove',e=&gt;{e.preventDefault();if(!isDrag)return;const el=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);if(el&amp;&amp;el.dataset.idx!==undefined)paintTL(el,+el.dataset.idx);},{passive:false});
      div.addEventListener('mousedown',()=&gt;{isDrag=true;paintTL(div,idx);});
      div.addEventListener('mouseenter',()=&gt;{if(isDrag)paintTL(div,idx);});
      cells.appendChild(div);
    }
    hour.appendChild(cells);
    grid.appendChild(hour);
  }
  document.addEventListener('mouseup',endDragTL);
  document.addEventListener('touchend',endDragTL);
  rTLSum();
}
function endDragTL(){if(isDrag){isDrag=false;sv();rTLSum();}}
function paintTL(td,idx){
  const g=getG(S.tlDate);
  if(tlCol==='clr'){g[idx]=null;td.className='tc-cell';td.style.opacity='';td.textContent='';}
  else{
    const sub=tlSub||(COLS.find(c=&gt;c.k===tlCol)?.s[0]?.k||null);
    g[idx]={c:tlCol,s:sub};
    td.className=`tc-cell c-${tlCol}`;
    const col=COLS.find(c=&gt;c.k===tlCol);
    const si=col?col.s.findIndex(s=&gt;s.k===sub):0;
    td.style.opacity=SHADE[Math.min(si&lt;0?0:si,SHADE.length-1)];
    td.textContent=col&amp;&amp;si&gt;=0&amp;&amp;col.s[si]?col.s[si].l.slice(0,2):'';
  }
}
function rTLSum(){
  const g=getG(S.tlDate);
  const cts={};COLS.forEach(c=&gt;{cts[c.k]={tot:0,s:{}};c.s.forEach(s=&gt;cts[c.k].s[s.k]=0);});
  g.forEach(c=&gt;{if(!c||!cts[c.c])return;cts[c.c].tot++;if(c.s&amp;&amp;cts[c.c].s[c.s]!==undefined)cts[c.c].s[c.s]++;});
  const sum=document.getElementById('tlSum');
  sum.innerHTML=COLS.filter(c=&gt;cts[c.k].tot&gt;0).map(c=&gt;{
    const hrs=(cts[c.k].tot*0.25).toFixed(2);
    const subTxt=c.s.filter(s=&gt;cts[c.k].s[s.k]&gt;0).map(s=&gt;`${s.l} ${(cts[c.k].s[s.k]*0.25).toFixed(2)}h`).join(' Â· ');
    return`<div class="tc-sum-row"><div class="tc-sum-dot" style="background:${c.h}"></div><div class="tc-sum-name">${c.l}<br><span style="font-size:11px;color:var(--text2)">${subTxt}</span></div><div class="tc-sum-val">${hrs}h</div></div>`;
  }).join('');
}
function tlNav(d){const dt=new Date(S.tlDate+'T00:00:00');dt.setDate(dt.getDate()+d);S.tlDate=dt.toISOString().slice(0,10);sv();rTimeline();}
function tlToday(){S.tlDate=tod();sv();rTimeline();}

// â•â•â• DAILY â•â•â•
function rDaily(){
  const done=S.daily.filter(x=&gt;x.st==='d').length,tot=S.daily.length;
  const pct=tot?Math.round(done/tot*100):0;
  const co=138.2*(1-pct/100);
  document.getElementById('scorecard').innerHTML=`
    <svg width="58" height="58"><circle cx="29" cy="29" r="22" fill="none" stroke="#1c1c32" stroke-width="5"></circle>
    <circle cx="29" cy="29" r="22" fill="none" stroke="${pct===100?&#39;#3ddc84&#39;:&#39;#ffd060&#39;}" stroke-width="5" stroke-dasharray="138.2" stroke-dashoffset="${co}" stroke-linecap="round" transform="rotate(-90 29 29)"></circle></svg>
    <div style="flex:1">
      <div style="font-size:26px;font-weight:900;font-family:&#39;Share Tech Mono&#39;,monospace;color:${pct===100?&#39;#3ddc84&#39;:&#39;#ffd060&#39;}">${pct}%</div>
      <div style="font-size:12px;color:var(--text2);margin-top:2px">${done}/${tot} å®Œæˆ</div>
    </div>
    ${pct===100?'<div style="font-size:13px;font-weight:700;background:linear-gradient(90deg,#4a9eff,#3ddc84);-webkit-background-clip:text;-webkit-text-fill-color:transparent">ğŸ’ å…¨å‹¤ï¼</div>':''}`;
  document.getElementById('dlist').innerHTML=S.daily.map(t=&gt;`
    <div class="dcard ${t.st===&#39;d&#39;?&#39;done&#39;:t.st===&#39;f&#39;?&#39;fail&#39;:&#39;&#39;}" onclick="cycD(&#39;${t.id}&#39;)">
      <div class="dchk">${t.st==='d'?'âœ“':t.st==='f'?'âœ—':''}</div>
      <div class="dico">${t.ic||'ğŸ“Œ'}</div>
      <div class="dinfo"><div class="dname">${t.n}</div>${t.r?`<div class="dreq">${t.r}</div>`:''}</div>
      ${t.sk&gt;0?`<div class="strk">ğŸ”¥${t.sk}å¤©</div>`:''}
      <button onclick="event.stopPropagation();delD(&#39;${t.id}&#39;)" style="background:none;border:none;color:var(--text2);font-size:18px;cursor:pointer;padding:0 2px;flex-shrink:0">Ã—</button>
    </div>`).join('');
  document.getElementById('flist').innerHTML=S.forb.map(f=&gt;`
    <div class="dcard ${f.st===&#39;kept&#39;?&#39;done&#39;:f.st===&#39;broke&#39;?&#39;fail&#39;:&#39;&#39;}" onclick="cycF(&#39;${f.id}&#39;)">
      <span style="font-size:20px">${f.ic}</span>
      <span style="flex:1;font-size:14px;font-weight:600">${f.n}</span>
      <span class="dchk" style="width:auto;padding:3px 8px;font-size:11px">${f.st==='kept'?`âœ“ ${f.d}å¤©`:f.st==='broke'?'âœ— å¤±è´¥':'å¾…è®°å½•'}</span>
      <button onclick="event.stopPropagation();delF(&#39;${f.id}&#39;)" style="background:none;border:none;color:var(--text2);font-size:18px;cursor:pointer;padding:0 2px;flex-shrink:0">Ã—</button>
    </div>`).join('');
}
function cycD(id){const t=S.daily.find(x=&gt;x.id===id);if(!t)return;const c=['p','d','f'];t.st=c[(c.indexOf(t.st)+1)%3];if(t.st==='d')t.sk=(t.sk||0)+1;sv();rDaily();}
function delD(id){S.daily=S.daily.filter(x=&gt;x.id!==id);sv();rDaily();}
function cycF(id){const f=S.forb.find(x=&gt;x.id===id);if(!f)return;const c=['p','kept','broke'];f.st=c[(c.indexOf(f.st)+1)%3];if(f.st==='kept')f.d=(f.d||0)+1;sv();rDaily();}
function delF(id){S.forb=S.forb.filter(x=&gt;x.id!==id);sv();rDaily();}
function allForbKept(){S.forb.forEach(f=&gt;{if(f.st!=='broke'){f.st='kept';f.d=(f.d||0)+1;}});sv();rDaily();}

// â•â•â• TASKS â•â•â•
let tMain='all',tSub='today',showDone=false;
const TM=[{k:'all',l:'å…¨éƒ¨'},{k:'main',l:'ğŸš© ä¸»çº¿ä»»åŠ¡'},{k:'side',l:'ğŸ”¹ æ”¯çº¿ä»»åŠ¡'},{k:'over',l:'âš ï¸ é¡ºå»¶ä»»åŠ¡'}];
const TS=[{k:'today',l:'ä»Šæ—¥'},{k:'long',l:'é•¿æœŸ'},{k:'box',l:'ğŸ“¦ æ”¶é›†ç®±'}];
const TPMAP={'mt':'ä¸»çº¿ä»Šæ—¥','ml':'ä¸»çº¿é•¿æœŸ','st':'æ”¯çº¿ä»Šæ—¥','sl':'æ”¯çº¿é•¿æœŸ','bx':'æ”¶é›†ç®±','ov':'é¡ºå»¶'};
const TBCLS={'mt':'bm','ml':'bm','st':'bs','sl':'bs','bx':'bb','ov':'bo'};
function taskCount(type){
  if(type==='main')return S.tasks.filter(t=&gt;(t.tp==='mt'||t.tp==='ml')&amp;&amp;!t.done).length;
  if(type==='side')return S.tasks.filter(t=&gt;(t.tp==='st'||t.tp==='sl')&amp;&amp;!t.done).length;
  if(type==='over')return S.tasks.filter(t=&gt;t.tp==='ov').length;
  return 0;
}
function subCount(mainType,subType){
  if(mainType==='main'){
    if(subType==='today')return S.tasks.filter(t=&gt;t.tp==='mt'&amp;&amp;!t.done).length;
    if(subType==='long')return S.tasks.filter(t=&gt;t.tp==='ml'&amp;&amp;!t.done).length;
    if(subType==='box')return S.tasks.filter(t=&gt;t.tp==='bx').length;
  }
  if(mainType==='side'){
    if(subType==='today')return S.tasks.filter(t=&gt;t.tp==='st'&amp;&amp;!t.done).length;
    if(subType==='long')return S.tasks.filter(t=&gt;t.tp==='sl'&amp;&amp;!t.done).length;
    if(subType==='box')return S.tasks.filter(t=&gt;t.tp==='bx').length;
  }
  return 0;
}
<script>
function rTasks(){
  document.getElementById('tmtabs').innerHTML=TM.map(t=>{
    const cnt=t.k!=='all'?taskCount(t.k):0;
    const badge=cnt>0?`<div class="badge">${cnt}</div>`:'';
    return`<button class="tmtab${tMain===t.k?' on':''}" onclick="setTM('${t.k}')">${t.l}${badge}</button>`;
  }).join('');
  const showSub=tMain==='main'||tMain==='side';
  document.getElementById('tstabs').innerHTML=showSub?TS.map(t=>{
    const cnt=subCount(tMain,t.k);
    const badge=cnt>0?`<div class="badge">${cnt}</div>`:'';
    return`<button class="tstab${tSub===t.k?' on':''}" onclick="setTS('${t.k}')">${t.l}${badge}</button>`;
  }).join(''):'';
  const ml=TM.find(t=>t.k===tMain)?.l||'å…¨éƒ¨';
  const sl=showSub?' Â· '+(TS.find(t=>t.k===tSub)?.l||''):'';
  document.getElementById('tlabel').textContent=ml+sl;
  let tasks=S.tasks;
  if(tMain==='over')tasks=S.tasks.filter(t=>t.tp==='ov');
  else if(tMain==='main'){
    if(tSub==='today')tasks=S.tasks.filter(t=>t.tp==='mt');
    else if(tSub==='long')tasks=S.tasks.filter(t=>t.tp==='ml');
    else tasks=S.tasks.filter(t=>t.tp==='bx');
  }else if(tMain==='side'){
    if(tSub==='today')tasks=S.tasks.filter(t=>t.tp==='st');
    else if(tSub==='long')tasks=S.tasks.filter(t=>t.tp==='sl');
    else tasks=S.tasks.filter(t=>t.tp==='bx');
  }
  rTaskList(tasks);
}
function rTaskList(tasks){
  if(!tasks){
    tasks=S.tasks;
    if(tMain==='over')tasks=S.tasks.filter(t=>t.tp==='ov');
    else if(tMain==='main'){
      if(tSub==='today')tasks=S.tasks.filter(t=>t.tp==='mt');
      else if(tSub==='long')tasks=S.tasks.filter(t=>t.tp==='ml');
      else tasks=S.tasks.filter(t=>t.tp==='bx');
    }else if(tMain==='side'){
      if(tSub==='today')tasks=S.tasks.filter(t=>t.tp==='st');
      else if(tSub==='long')tasks=S.tasks.filter(t=>t.tp==='sl');
      else tasks=S.tasks.filter(t=>t.tp==='bx');
    }
  }
  const pending=tasks.filter(t=>!t.done&&t.tp!=='ov');
  const overdues=tasks.filter(t=>t.tp==='ov');
  const done=tasks.filter(t=>t.done);
  const isBox=t=>t.tp==='bx';
  function mkCard(t){
    return`<div class="tcard ${t.done?'done':''} ${t.tp==='ov'?'ov':''}" onclick="${!isBox(t)?`togT('${t.id}')`:''}" >
      <div class="ttop">
        ${isBox(t)?`<span style="font-size:16px;margin-top:2px;flex-shrink:0">ğŸ“¦</span>`:`<div class="tcb">${t.done?'âœ“':''}</div>`}
        <div class="ttit">${t.t}</div>
        <div class="tbadge ${TBCLS[t.tp]||'bb'}">${TPMAP[t.tp]||''}</div>
      </div>
      ${t.n?`<div class="tnote">${t.n}</div>`:''}
      <div class="tmeta">
        ${t.due?`<span class="tdue">æˆªæ­¢ ${t.due}</span>`:''}
        ${t.tp!=='ov'?`<button class="tbtn" style="color:var(--re)" onclick="event.stopPropagation();toOv('${t.id}')">â†’ é¡ºå»¶</button>`:`<button class="tbtn" style="color:var(--gr)" onclick="event.stopPropagation();fromOv('${t.id}')">â†© æ¢å¤</button>`}
        <button class="tbtn" style="color:var(--text2)" onclick="event.stopPropagation();delT('${t.id}')">Ã— åˆ é™¤</button>
      </div>
    </div>`;
  }
  const tl=document.getElementById('tlist');
  if(!pending.length&&!overdues.length&&!done.length){tl.innerHTML=`<div class="empty"><div class="ei">ğŸ“‹</div><p>æš‚æ— ä»»åŠ¡</p></div>`;return;}
  let html='';
  if(overdues.length){html+=`<div style="font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--re);text-transform:uppercase;padding:6px 0 4px">âš ï¸ é¡ºå»¶ (${overdues.length})</div>`;html+=overdues.map(mkCard).join('');}
  if(pending.length){html+=overdues.length?`<div style="font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--text2);text-transform:uppercase;padding:8px 0 4px">å¾…å®Œæˆ (${pending.length})</div>`:'';html+=pending.map(mkCard).join('');}
  if(showDone&&done.length){html+=`<div style="font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--gr);text-transform:uppercase;padding:8px 0 4px;margin-top:4px;border-top:1px solid var(--border)">âœ… å·²å®Œæˆ (${done.length})</div>`;html+=done.map(mkCard).join('');}
  else if(!showDone&&done.length){html+=`<div style="font-size:12px;color:var(--text2);text-align:center;padding:10px;cursor:pointer" onclick="toggleShowDone()">å·²å®Œæˆ ${done.length} é¡¹ï¼Œç‚¹å‡»æŸ¥çœ‹ â€º</div>`;}
  tl.innerHTML=html;
}
function setTM(k){tMain=k;tSub='today';rTasks();}
function setTS(k){tSub=k;rTasks();}
function toggleShowDone(){showDone=!showDone;const btn=document.getElementById('doneToggleBtn');if(btn){btn.textContent=showDone?'éšè—å·²å®Œæˆ':'æ˜¾ç¤ºå·²å®Œæˆ';btn.style.color=showDone?'var(--gr)':'var(--text2)';}rTaskList();}
function togT(id){const t=S.tasks.find(x=>x.id===id);if(!t)return;t.done=!t.done;if(t.done)S.memory.taskFlow.unshift(`${tod()} âœ“ ${t.t}`);sv();rTasks();}
function delT(id){S.tasks=S.tasks.filter(x=>x.id!==id);sv();rTasks();}
function toOv(id){const t=S.tasks.find(x=>x.id===id);if(t){t.tp='ov';sv();rTasks();}}
function fromOv(id){const t=S.tasks.find(x=>x.id===id);if(t){t.tp='mt';sv();rTasks();}}

// â•â•â• å±æ€§ â•â•â•
function rAttr(){
  document.getElementById('heroName').textContent=S.userName;
  document.getElementById('heroDay').textContent=`Day ${dn()} Â· ${tod()}`;
  const tot=compTotal();
  const today=compA(tod());
  const max=Math.max(...ATTRS.map(a=>tot[a.k]),1);
  document.getElementById('attrGrid').innerHTML=ATTRS.map(a=>`
    <div class="abox" style="grid-column:${a.k==='ap'?'1/-1':'span 1'}">
      <div class="abox-lbl">${a.l}</div>
      <div><span class="abox-val" style="color:${a.c}">${tot[a.k].toFixed(2)}</span></div>
      <div style="margin-top:6px;height:8px;background:var(--bg3);border-radius:4px;overflow:hidden">
        <div style="height:100%;background:${a.c};width:${tot[a.k]/max*100}%;transition:width .4s"></div>
      </div>
    </div>`).join('');
  document.getElementById('todayGrid').innerHTML=ATTRS.map(a=>`
    <div class="abox" style="grid-column:${a.k==='ap'?'1/-1':'span 1'}">
      <div class="abox-lbl">${a.l}</div>
      <div><span class="abox-val" style="color:${a.c}">+${today[a.k].toFixed(2)}</span></div>
    </div>`).join('');
}

// â•â•â• è®°å¿†ä¸­å¿ƒ â•â•â•
let memTab='user';
function setMemTab(tab,btn){
  memTab=tab;
  document.querySelectorAll('.mtab').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  rMemContent();
}
function rMemContent(){
  const c=document.getElementById('memContent');
  if(memTab==='user'){
    c.innerHTML=`<div class="sh"><span class="sh-t">ç”¨æˆ·è®°å¿†</span><button class="sh-a" onclick="openM('editUserMem')">ç¼–è¾‘</button></div>`;
    if(!S.memory.user.length)c.innerHTML+=`<div class="empty"><p>æš‚æ— ç”¨æˆ·è®°å¿†</p></div>`;
    else c.innerHTML+=S.memory.user.map((m,i)=>`<div class="mem-item"><div class="mem-item-content">${m}</div></div>`).join('');
  }
  else if(memTab==='time'){
    c.innerHTML=`<div class="sh"><span class="sh-t">æ—¶é—´æµæ°´</span></div>`;
    if(!S.memory.timeFlow.length)c.innerHTML+=`<div class="empty"><p>æš‚æ— æ—¶é—´è®°å½•</p></div>`;
    else c.innerHTML+=`<div class="flow-list">${S.memory.timeFlow.slice(0,50).map(f=>`<div class="flow-item">${f}</div>`).join('')}</div>`;
  }
  else if(memTab==='task'){
    c.innerHTML=`<div class="sh"><span class="sh-t">ä»»åŠ¡æµæ°´</span></div>`;
    if(!S.memory.taskFlow.length)c.innerHTML+=`<div class="empty"><p>æš‚æ— ä»»åŠ¡è®°å½•</p></div>`;
    else c.innerHTML+=`<div class="flow-list">${S.memory.taskFlow.slice(0,50).map(f=>`<div class="flow-item">${f}</div>`).join('')}</div>`;
  }
  else if(memTab==='pref'){
    c.innerHTML=`<div class="sh"><span class="sh-t">ç©å®¶åå¥½</span><button class="sh-a" onclick="openM('editPref')">ç¼–è¾‘</button></div>`;
    if(!S.memory.pref.length)c.innerHTML+=`<div class="empty"><p>æš‚æ— åå¥½è®°å½•</p></div>`;
    else c.innerHTML+=S.memory.pref.map(p=>`<div class="mem-item"><div class="mem-item-content">${p}</div></div>`).join('');
  }
}
function rMemory(){rMemContent();}

// â•â•â• MODAL â•â•â•
function openM(type){
  document.getElementById('mbg').classList.add('show');
  if(type==='adDaily'){
    document.getElementById('mtit').textContent='æ·»åŠ æ¯æ—¥ä»»åŠ¡';
    document.getElementById('mbody').innerHTML=`
      <div class="fl"><label class="flab">å›¾æ ‡ï¼ˆemojiï¼‰</label><input class="fi" id="mIcon" placeholder="ğŸ“Œ" maxlength="2"></div>
      <div class="fl"><label class="flab">ä»»åŠ¡åç§°</label><input class="fi" id="mName" placeholder="ä¾‹ï¼šå†¥æƒ³"></div>
      <div class="fl"><label class="flab">è¦æ±‚ï¼ˆå¯é€‰ï¼‰</label><input class="fi" id="mReq" placeholder="ä¾‹ï¼šâ‰¥30åˆ†é’Ÿ"></div>
      <button class="fbtn" onclick="doAdD()">æ·»åŠ </button>`;
  }else if(type==='adForb'){
    document.getElementById('mtit').textContent='æ·»åŠ ç¦æ­¢äº‹é¡¹';
    document.getElementById('mbody').innerHTML=`
      <div class="fl"><label class="flab">å›¾æ ‡</label><input class="fi" id="mFIcon" placeholder="ğŸš«" maxlength="2"></div>
      <div class="fl"><label class="flab">åç§°</label><input class="fi" id="mFName" placeholder="ä¾‹ï¼šæˆ’æ‰‹æ¸¸"></div>
      <button class="fbtn" onclick="doAdF()">æ·»åŠ </button>`;
  }else if(type==='adTask'){
    document.getElementById('mtit').textContent='æ–°å¢ä»»åŠ¡';
    document.getElementById('mbody').innerHTML=`
      <div class="fl"><label class="flab">ä»»åŠ¡åç§°</label><input class="fi" id="mTN" placeholder="ä»»åŠ¡åç§°..."></div>
      <div class="fl"><label class="flab">ç±»å‹</label>
        <select class="fs" id="mTT">
          <option value="mt">ğŸš© ä¸»çº¿Â·ä»Šæ—¥</option>
          <option value="ml">ğŸš© ä¸»çº¿Â·é•¿æœŸ</option>
          <option value="st">ğŸ”¹ æ”¯çº¿Â·ä»Šæ—¥</option>
          <option value="sl">ğŸ”¹ æ”¯çº¿Â·é•¿æœŸ</option>
          <option value="bx">ğŸ“¦ æ”¶é›†ç®±</option>
        </select></div>
      <div class="fl"><label class="flab">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label><input class="fi" id="mTNo" placeholder="å¤‡æ³¨..."></div>
      <div class="fl"><label class="flab">æˆªæ­¢æ—¥æœŸï¼ˆå¯é€‰ï¼‰</label><input class="fi" type="date" id="mTDue"></div>
      <button class="fbtn" onclick="doAdT()">æ·»åŠ </button>`;
  }else if(type==='editUserMem'){
    document.getElementById('mtit').textContent='ç¼–è¾‘ç”¨æˆ·è®°å¿†';
    document.getElementById('mbody').innerHTML=`
      <div class="fl"><label class="flab">ç”¨æˆ·è®°å¿†ï¼ˆæ¯è¡Œä¸€æ¡ï¼‰</label>
      <textarea class="fta" id="mUserMem">${S.memory.user.join('\n')}</textarea></div>
      <button class="fbtn" onclick="doEditUserMem()">ä¿å­˜</button>`;
  }else if(type==='editPref'){
    document.getElementById('mtit').textContent='ç¼–è¾‘ç©å®¶åå¥½';
    document.getElementById('mbody').innerHTML=`
      <div class="fl"><label class="flab">ç©å®¶åå¥½ï¼ˆæ¯è¡Œä¸€æ¡ï¼‰</label>
      <textarea class="fta" id="mPref">${S.memory.pref.join('\n')}</textarea></div>
      <button class="fbtn" onclick="doEditPref()">ä¿å­˜</button>`;
  }
}
function doAdD(){const n=document.getElementById('mName').value.trim();if(!n)return;S.daily.push({id:'d'+Date.now(),n,ic:document.getElementById('mIcon').value.trim()||'ğŸ“Œ',r:document.getElementById('mReq').value.trim(),st:'p',sk:0});sv();closeM();rDaily();}
function doAdF(){const n=document.getElementById('mFName').value.trim();if(!n)return;S.forb.push({id:'f'+Date.now(),n,ic:document.getElementById('mFIcon').value.trim()||'ğŸš«',st:'p',d:0});sv();closeM();rDaily();}
function doAdT(){const t=document.getElementById('mTN').value.trim();if(!t)return;S.tasks.push({id:'t'+Date.now(),t,tp:document.getElementById('mTT').value,n:document.getElementById('mTNo').value.trim(),due:document.getElementById('mTDue').value||null,done:false});sv();closeM();rTasks();}
function doEditUserMem(){S.memory.user=document.getElementById('mUserMem').value.split('\n').filter(l=>l.trim());sv();closeM();rMemory();}
function doEditPref(){S.memory.pref=document.getElementById('mPref').value.split('\n').filter(l=>l.trim());sv();closeM();rMemory();}
function closeM(){document.getElementById('mbg').classList.remove('show');}
function bgC(e){if(e.target===document.getElementById('mbg'))closeM();}

// â•â•â• INIT â•â•â•
function init(){
  ld();
  if(!S.tlDate)S.tlDate=tod();
  rHdr();
  initAI();
  setInterval(rHdr,60000);
}
init();
</script>


</body></html>
